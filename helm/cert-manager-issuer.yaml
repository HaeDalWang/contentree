---
# ============================================
# 옵션 1: DNS-01 챌린지 (와일드카드 인증서 가능) - 권장!
# Route53 사용 시
# ============================================
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: svvwac98@gmail.com
    privateKeySecretRef:
      name: letsencrypt-prod-key
    solvers:
      # DNS-01 챌린지 (Route53)
      - dns01:
          route53:
            region: ap-northeast-2
        selector:
          dnsZones:
            - "seungdobae.com"
---
# 와일드카드 인증서 (DNS-01 필수!)
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: wildcard-joins-seungdobae
  namespace: envoy-gateway-system
spec:
  secretName: tls-joins.com  # 이 이름으로 Secret 생성됨
  issuerRef:
    name: letsencrypt-prod
    kind: ClusterIssuer
  commonName: "joins.seungdobae.com"
  dnsNames:
    - "joins.seungdobae.com"
    - "*.joins.seungdobae.com"
---
# ============================================
# 옵션 2: HTTP-01 챌린지 (개별 도메인만, 와일드카드 불가)
# DNS 설정 없이 간단하게 하고 싶을 때
# ============================================
# apiVersion: cert-manager.io/v1
# kind: ClusterIssuer
# metadata:
#   name: letsencrypt-http01
# spec:
#   acme:
#     server: https://acme-v02.api.letsencrypt.org/directory
#     email: your-email@example.com
#     privateKeySecretRef:
#       name: letsencrypt-http01-key
#     solvers:
#       - http01:
#           gatewayHTTPRoute:
#             parentRefs:
#               - name: eg
#                 namespace: envoy-gateway-system
# ---
# # 개별 도메인 인증서 (HTTP-01)
# apiVersion: cert-manager.io/v1
# kind: Certificate
# metadata:
#   name: argocd-cert
#   namespace: envoy-gateway-system
# spec:
#   secretName: tls-argocd
#   issuerRef:
#     name: letsencrypt-http01
#     kind: ClusterIssuer
#   dnsNames:
#     - "argocd.joins.seungdobae.com"
